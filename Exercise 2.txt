Question 3)
Initial public key algorithms do not require a secure channel for the initial exchange of the keys. After the Diffe-Hellman key exchange has taken place the resulting session keys Key A and Key B can be used to create a secure channel for further communication between two people (Alice and Bob). To set up this secure channel there has to be some secret information which both people know and a way to for each person to check that the other knows this information. Since I performed a key derivation function both KeyA and KeyB are the same and can be used with symmetric encryption and MAC. The key is then used as a key in the Mac which person A can encrypt, person B can then decrypt the MAC since they both know the key. Using this technique both people can verify the MAC. This provides a connection that is resistant to a man in the middle attack as both people can authenticate who is sending the message. To construct a secure create a secure MAC I would use a HMAC to concatenate the key and the message. I would use a function such as H(k1, H(k2, m) where k1 and k2 are different keys and m is the message, one key would have to be unknown to anyone listening in on the conversation but known to both Alice and Bob (secret). So I would use the generated Key Alice and bob produced after the exchange as Alice and bob will have both generated that value and so can encrypt and decrypt the MAC and message. This will provide a secure channel that has confidentiality and integrity as people can authenticate and encrypt the messages, making them resistant to tampering. However using this technique you would have to defend against Verification timing attacks by making sure the string comparator always takes the same amount of time to return a result. 

Question 4a)
Since the Diffe-Hellman key exchange is an unauthenticated key exchange it is susceptible to a man in the middle attack. During this attack, a third person Eve intercepts Alice’s message that contains her generator, modulus and her public value, and substitutes in her own values, which are then sent to Bob. Then when Bob send his public value Eve intercepts his massage in again substitutes in her own value and sends it to Alice. By doing this Alice thinks Eve is Bob and Bob thinks Eve is Alice. This means Alice and Eve agree on one shared key and Eve and Bob agree on another shared key. Once this exchange has taken place Eve simply decrypts any messages sent by Alice or Bob, allowing her to read and possibly modify them before re-encrypting them with the appropriate key and transmitting them to their intended person. Possible ways to fight against this is to use digital signatures or MACs to create a secure channel.